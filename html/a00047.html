<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>embedded system library for e-puck: Camera</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doc_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="el_logo_color_icon.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">embedded system library for e-puck
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">A redesigned API library for the e-puck robot platform</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">Camera</div>  </div>
</div><!--header-->
<div class="contents">

<p>interface of the camera module  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:a00017"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00017.html">el_camera.h</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>interface of the camera module </p>
<h1><a class="anchor" id="sec1"></a>
Introduction</h1>
<p>In this library, the resolution of the image captured by the camera is fixed to 40x15 with a maximum frame rate of 18.432. This resolution is a result of subsampling, which means field of view (FOV) of the image is not lost. The horizontal FOV of the camera is about 56 deg while the vertical FOV is about 42 deg. Both FOV are almost fully covered in the captured image.</p>
<p>The camera module in this library uses dual-buffer-swapping mechanism. At any moment, data acquired from the camera are written to frame buffer A (the front buffer) while any reading functions read data from frame buffer B (the back buffer). Once a frame is fully written, pointers to the two buffers will be swapped. This mechanism allows a frame of image to be processed concurrently with the acquisition of next frame.</p>
<h1><a class="anchor" id="sec2"></a>
Usage</h1>
<p>To run something when a frame of image is ready, create a trigger with EL_EVENT_CAMERA_FRAME_UPDATE event.</p>
<p>Before reading data in the frame buffer, it (the back buffer) needs to be locked. The following mechanism is a typical loop to process a frame: </p><div class="fragment"><div class="line">...</div>
<div class="line">el_uint8 RGB[3];</div>
<div class="line"><span class="keywordtype">int</span> X,Y,W,H;</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">el_camera_lock_frame();</div>
<div class="line">W = <a class="code" href="a00017.html#abe3367f2172a48c1dcd28d974e64388e">el_camera_get_frame_width</a>();</div>
<div class="line">H = <a class="code" href="a00017.html#a0f7eb3a2e184575e94274c7d4cb75436">el_camera_get_frame_height</a>();</div>
<div class="line"><span class="keywordflow">for</span>(X=0;X&lt;W;X++){</div>
<div class="line">    <span class="keywordflow">for</span>(Y=0;Y&lt;H;Y++){</div>
<div class="line">        </div>
<div class="line">        <a class="code" href="a00017.html#a0e31a461b852a03f3d422f98ca77428a">el_camera_get_frame_pixel</a>( X, Y, RGB );</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// image processing algorithm</span></div>
<div class="line">        ...</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><a class="code" href="a00017.html#ae32672c397e15c30cbe8b7b5b5f874ce">el_camera_unlock_frame</a>();</div>
<div class="line">...</div>
</div><!-- fragment --><p> When the frame buffer is locked, no further buffer swapping will occur. Therefore, the time cost of the image processing code ought to be less than the update interval of the frames if each of the frames from the camera need to be processed.</p>
<p>See <a class="el" href="index.html#sec_ex02">Example 2</a> for a systematic usage of the camera module with some image processing techniques.</p>
<h1><a class="anchor" id="sec3"></a>
Configuration</h1>
<p>In Example 3, the robot can transmit camera images via UART1. While using the serial communication utility of this lib, the incoming images will be saved as BMP files. A suitable camera configuration can be tuned based on the images.</p>
<p>The actual frame rate achieved depends on the exposure mode used. When automatic exposure control is used and the environment is not well illuminated, the frame rate may drop to ~9. Fixed time exposure mode can be used to stablize the frame rate. For example: </p><div class="fragment"><div class="line">...</div>
<div class="line">el_camera_options_reset();</div>
<div class="line"><a class="code" href="a00017.html#a0c16455023d3980e9ebd50ad39a35bc1">el_camera_options</a>()-&gt;<a class="code" href="a00006.html#a5c2725b38e0e6dda7fa8619ff17e8242">ExposureMode</a> = <a class="code" href="a00017.html#ae3dd3a05038328cf4dd7b6fc78f41fd9a5ad03bb29714b2671b3e125788352aea">EL_EXPOSURE_TIME</a>;</div>
<div class="line"><a class="code" href="a00017.html#a0c16455023d3980e9ebd50ad39a35bc1">el_camera_options</a>()-&gt;<a class="code" href="a00006.html#a96a5f876f12e2278dd5f0fca979e368f">ExposureTime</a> = 10.0f;<span class="comment">// 10.0 gives about 14 fps</span></div>
<div class="line"><a class="code" href="a00017.html#abd8ee3bbbd0f42137beee889b5ff00c8">el_camera_options_apply</a>();</div>
<div class="line">...</div>
</div><!-- fragment --><p> In <a class="el" href="a00017.html#ae3dd3a05038328cf4dd7b6fc78f41fd9a5ad03bb29714b2671b3e125788352aea" title="use ExposureTime ">EL_EXPOSURE_TIME</a> mode, the framerate will become lower than 18.4 when the <code>ExposureTime</code> is set to be bigger than 7.5 approximately.</p>
<p>More detailed information about tuning the camera should be found in the datasheet of PO6030K.</p>
<h1><a class="anchor" id="ssec_cam_appendix"></a>
Appendix</h1>
<p>For reference, the setting used in our lab in Sheffield Robotics is: </p><div class="fragment"><div class="line">...</div>
<div class="line"></div>
<div class="line">el_camera_options_reset();</div>
<div class="line"><a class="code" href="a00017.html#a0c16455023d3980e9ebd50ad39a35bc1">el_camera_options</a>()-&gt;<a class="code" href="a00006.html#a5c2725b38e0e6dda7fa8619ff17e8242">ExposureMode</a> = <a class="code" href="a00017.html#ae3dd3a05038328cf4dd7b6fc78f41fd9a5ad03bb29714b2671b3e125788352aea">EL_EXPOSURE_TIME</a>;</div>
<div class="line"><a class="code" href="a00017.html#a0c16455023d3980e9ebd50ad39a35bc1">el_camera_options</a>()-&gt;<a class="code" href="a00006.html#a96a5f876f12e2278dd5f0fca979e368f">ExposureTime</a> = 8.0f;<span class="comment">// gives about 18.0 fps</span></div>
<div class="line"><a class="code" href="a00017.html#a0c16455023d3980e9ebd50ad39a35bc1">el_camera_options</a>()-&gt;AutoDigitalGain = <span class="keyword">false</span>;</div>
<div class="line"><a class="code" href="a00017.html#a0c16455023d3980e9ebd50ad39a35bc1">el_camera_options</a>()-&gt;<a class="code" href="a00006.html#ac5c0c62073643d72f3ca970198447bff">DigitalGain</a> = 1.375f;</div>
<div class="line"><a class="code" href="a00017.html#a0c16455023d3980e9ebd50ad39a35bc1">el_camera_options</a>()-&gt;AutoWhiteBalance = <span class="keyword">false</span>;</div>
<div class="line"><a class="code" href="a00017.html#a0c16455023d3980e9ebd50ad39a35bc1">el_camera_options</a>()-&gt;<a class="code" href="a00006.html#a7757231840033cf3410b97ed93d3481a">RedGain</a> = 1.125f;</div>
<div class="line"><a class="code" href="a00017.html#a0c16455023d3980e9ebd50ad39a35bc1">el_camera_options</a>()-&gt;<a class="code" href="a00006.html#aa682d2e1a12d4005c02ebe61797441d5">GreenGain</a> = 1.0f;</div>
<div class="line"><a class="code" href="a00017.html#a0c16455023d3980e9ebd50ad39a35bc1">el_camera_options</a>()-&gt;<a class="code" href="a00006.html#ae6e70df6cba97baad2489830dd1debf9">BlueGain</a> = 1.375f;</div>
<div class="line"><a class="code" href="a00017.html#abd8ee3bbbd0f42137beee889b5ff00c8">el_camera_options_apply</a>();</div>
<div class="line"></div>
<div class="line">...</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 18 2015 22:30:01 for embedded system library for e-puck by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
