<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>embedded system library for e-puck: Trigger</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doc_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="el_logo_color_icon.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">embedded system library for e-puck
   &#160;<span id="projectnumber">1.0alpha</span>
   </div>
   <div id="projectbrief">A redesigned API library for the e-puck robot platform</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">Trigger</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:a00024"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html">el_trigger.h</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h1><a class="anchor" id="sec_trg_intro"></a>
Introduction</h1>
<p>A trigger can launch a process when a specified event occurs in the system. For example, a process can be launched automatically when the proximity sensors has a set of samples ready for use.</p>
<h1><a class="anchor" id="sec_trg_usage"></a>
Example Usage</h1>
<h2><a class="anchor" id="ssec_trg_usage_fcl"></a>
Feedback Control Loop</h2>
<p><a class="el" href="index.html#sec_ex04">Example 4</a> used the trigger mechanism to realize a control algorithm that uses camera image as input and hence executes every time when the camera is refreshed.</p>
<p>Here is an example of a control loop that takes the proximity sensors as input. The example assumes that the stepper motor and the infrared proximity sensors are enabled beforehand and the proximity sensors are working in <a class="el" href="a00017.html#ac9313b8eea9f5c0f35c39e3d205e5b2ea6e61f4edccd695b26cf205c95896ea7d" title="use the Pulse Mode (default mode) ">EL_IR_PROXIMITY_PULSE</a> mode.</p>
<p>Related global variables and function prototypes: </p><div class="fragment"><div class="line">el_handle trg_control_step;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> Trigger_ControStep_Setup();</div>
<div class="line"><span class="keywordtype">void</span> Trigger_ControStep_Clear();</div>
<div class="line"><span class="keywordtype">void</span> Trigger_ControStep_Process(el_handle this_trigger);</div>
</div><!-- fragment --><p>Code to setup/clear the trigger: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> Trigger_ControStep_Setup(){</div>
<div class="line">    </div>
<div class="line">    trg_control_step = <a class="code" href="a00024.html#a8ac98c499857cb3c18cd4093d5724264">el_create_trigger</a>();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// specify the event of triggering</span></div>
<div class="line">    <a class="code" href="a00024.html#a988d439b2dd5ee47173299dcc2666f16">el_trigger_set_event</a>( trg_control_step, <a class="code" href="a00024.html#a8b37a76e9a384d41426690a4cb74a044a0726cee4355067c6ec484245ed5e8bdf">EL_EVENT_IR_PROXIMITY_UPDATE</a> );</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// a condition callback is not essential for all triggers</span></div>
<div class="line">    <a class="code" href="a00024.html#a40e49c09f2deb3a73b9c2c42d784c04a">el_trigger_set_condition</a>( trg_control_step, NULL );</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// specify the process to launch when the event occurs</span></div>
<div class="line">    <a class="code" href="a00024.html#a4d4c08d0d4af965e7288feceb7ed50f6">el_trigger_set_process</a>( trg_control_step, Trigger_ControStep_Process );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> Trigger_ControStep_Clear(){</div>
<div class="line">    <a class="code" href="a00024.html#ad7941dead60d00b66ba64a8a7c952b1f">el_delete_trigger</a>( trg_control_step );</div>
<div class="line">}</div>
</div><!-- fragment --><p>Code of the trigger's process: </p><div class="fragment"><div class="line"><span class="comment">/* </span></div>
<div class="line"><span class="comment"> * Note: </span></div>
<div class="line"><span class="comment"> * For a trigger-launched process, the argument given to the entry function</span></div>
<div class="line"><span class="comment"> * is the handle of the trigger. </span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> Trigger_ControStep_Process(el_handle this_trigger){</div>
<div class="line">    el_int16 prox_value[8];</div>
<div class="line">    el_int16 mean;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// grab the reflection readings into an array</span></div>
<div class="line">    <a class="code" href="a00017.html#a282c79127fe99a71c2a4c92f671a7e56">el_ir_proximity_get</a>( EL_IR_PROXIMITY_SENSOR_ALL, <a class="code" href="a00017.html#a6777dd76bceec1ac25a170762e1331c9ae5a4bd267c0a73a9a30f2e8cd5aca1d7">EL_IR_REFLECTION</a>, prox_value );</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// assume that our algorithm needs the average of the two front sensors</span></div>
<div class="line">    mean = (prox_value[0] + prox_value[7])/2;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// the following algorithm let the robot keep a distance to anything in front</span></div>
<div class="line">    <span class="keywordflow">if</span>( mean &gt;= 900 ){</div>
<div class="line"></div>
<div class="line">        <a class="code" href="a00022.html#ac598d24601f69e215db8a5e364fa1f0d">el_set_wheel_speed</a>( -500, -500 );<span class="comment">// move backwards</span></div>
<div class="line"></div>
<div class="line">    }<span class="keywordflow">else</span></div>
<div class="line">    <span class="keywordflow">if</span>( mean &gt;= 300 ){<span class="comment">// with an implict condition: mean &lt; 900</span></div>
<div class="line"></div>
<div class="line">        <a class="code" href="a00022.html#ac598d24601f69e215db8a5e364fa1f0d">el_set_wheel_speed</a>( 0, 0 );<span class="comment">// don&#39;t move (distance is OK)</span></div>
<div class="line"></div>
<div class="line">    }<span class="keywordflow">else</span></div>
<div class="line">    <span class="keywordflow">if</span>( mean &gt;= 60 ){<span class="comment">// with an implict condition: mean &lt; 300</span></div>
<div class="line"></div>
<div class="line">        <a class="code" href="a00022.html#ac598d24601f69e215db8a5e364fa1f0d">el_set_wheel_speed</a>( 500, 500 );<span class="comment">// move forwards</span></div>
<div class="line"></div>
<div class="line">    }<span class="keywordflow">else</span>{<span class="comment">// with an implict condition: mean &lt; 60</span></div>
<div class="line"></div>
<div class="line">        <a class="code" href="a00022.html#ac598d24601f69e215db8a5e364fa1f0d">el_set_wheel_speed</a>( 0, 0 );<span class="comment">// no motion (nothing in front)</span></div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* </span></div>
<div class="line"><span class="comment">     * After a trigger&#39;s process is launched, the trigger will be disabled. </span></div>
<div class="line"><span class="comment">     * So re-enable the trigger after the process is done is necessary </span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <a class="code" href="a00024.html#ae8ee35672fb010ce11467750f6bfc63b">el_trigger_enable</a>( this_trigger );</div>
<div class="line">    </div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun May 17 2015 21:57:45 for embedded system library for e-puck by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
